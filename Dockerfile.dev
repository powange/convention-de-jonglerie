# Dockerfile.dev pour l'environnement de développement uniquement
ARG BASE_NODE_IMAGE=node:22-alpine
FROM ${BASE_NODE_IMAGE}
RUN apk add --no-cache libc6-compat curl openssl
WORKDIR /app

# Installer les dépendances
# - Si package-lock.json présent: npm ci (reproductible)
# - Sinon: npm install (fallback)
# L'ancien `npm ci || true` masquait les erreurs et pouvait laisser node_modules vide
COPY package*.json ./
RUN if [ -f package-lock.json ]; then \
            echo "Using npm ci" && npm ci; \
        else \
            echo "package-lock.json absent -> npm install" && npm install; \
        fi

# Variables d'env et ports de dev
ENV NODE_ENV=development \
    NUXT_HOST=0.0.0.0 \
    NUXT_PORT=3000

EXPOSE 3000 24678

# Démarre Nuxt en mode dev (le code est monté en volume via docker-compose.dev.yml)
CMD ["npm", "run", "dev"]
